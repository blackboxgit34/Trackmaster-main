!function (e) { function t(e) { return e % 2 == 0 ? !0 : !1 } function a(e, t, n) { var a = 10 - (t - e) / n * 10; return .02 * a } function i() { var e = window.location.hostname; e = "www." == e.substring(0, 4) ? e.substring(4, e.length) : e; var t = r(e), n = !1; "demonisblack.com" != t && (n = !0), "localhost" == t && (n = !1), n && (window.location = "http://codecanyon.net/item/wine-animation-html5-canvas/16245039") } function r(e) { var t; return t = e.indexOf("://") > -1 ? e.split("/")[2] : e.split("/")[0], t = t.split(":")[0] } var o = "wineAnimation", s = [], c = !1, d = 4, l = "yellow", u = "green", m = "orange", h = "red", g = "#00ff00", f = "#FF7F00", p = { image: "", backgroundImage: "", wineColour: "#330606", wineColourTop: "#630e0e", wineStartX: "EMPTY", wineStartY: 500, wineHeight: 500, wineWidth: 105, wineLevel: 0, wineSpeed: 2e3, wineLevelStatic: 0, maskPath: [], swirl: !0, swirlLoop: !1, swirlSpeed: 1e3, swirlRotateMax: 15, canvasW: 0, canvasH: 0, scalePercent: 1, manifest: [], isLoaded: !1, browserSupport: !1, edit: !1, editPointNum: -1 }; e.fn[o] = function (t, n, a) { if ("string" != typeof t) return this.each(function () { var n = e(this), a = e.extend({}, p, t); n.data("plugin_" + o, a), s.push(n), e.fn[o].destroy(n), e.fn[o].detectBrowser(n) }); var i = e(this), r = i.data("plugin_" + o); void 0 != r && e.fn[o].commandWineAnimation(this, t, n, a) }, e.fn[o].detectBrowser = function (t) { return t.each(function () { var t = e(this), n = t.data("plugin_" + o), a = document.createElement("canvas"); a.getContext && (n.browserSupport = !0), n.browserSupport && (n.isLoaded || (n.isLoaded = !0, i(), e.fn[o].initPreload(t))) }) }, e.fn[o].initPreload = function (t) { return t.each(function () { var t = e(this), n = t.data("plugin_" + o); n.stageW = n.canvasW = t.attr("width"), n.stageH = n.canvasH = t.attr("height"), n.manifest = [], "" != n.image && n.manifest.push({ src: n.image, id: "bottle" }), "" != n.backgroundImage && n.manifest.push({ src: n.backgroundImage, id: "background" }), n.manifest.length > 0 ? (n.loader = new createjs.LoadQueue(!1), n.loader.on("complete", function () { e.fn[o].handleLoaderComplete(t) }), n.loader.on("progress", function () { e.fn[o].handleLoaderProgress(t) }), n.loader.loadManifest(n.manifest)) : e.fn[o].handleLoaderComplete(t) }) }, e.fn[o].handleLoaderComplete = function (t) { return t.each(function () { var t = e(this), n = t.data("plugin_" + o); n.edit && (n.scalePercent = 1), e.fn[o].initWineCanvas(t), e.fn[o].buildWineCanvas(t), n.edit ? (e.fn[o].buildEditCanvas(t), e.fn[o].resetEditStage(t), e.fn[o].drawDots(t), e.fn[o].redrawEdit(t)) : (e.fn[o].animateWine(t, !0), e.fn[o].animateWineSwirl(t)) }) }, e.fn[o].handleLoaderProgress = function (t) { return t.each(function () { var t = e(this); t.data("plugin_" + o) }) }, e.fn[o].initWineCanvas = function (t) { return t.each(function () { var t = e(this), n = t.data("plugin_" + o); n.stage = new createjs.Stage(t.attr("id")), c || (c = !0, createjs.Ticker.setFPS(60), createjs.Ticker.addEventListener("tick", e.fn[o].tick)) }) }, e.fn[o].buildWineCanvas = function (a) { return a.each(function () { var a = e(this), i = a.data("plugin_" + o); if (i.itemCanvasContainer = new createjs.Container, "" != i.image && (i.itemBottle = new createjs.Bitmap(i.loader.getResult("bottle"))), "" != i.backgroundImage && (i.itemBackground = new createjs.Bitmap(i.loader.getResult("background"))), i.itemWineMask = new createjs.Shape, i.itemWineMask.graphics.clear(), i.itemWineMask.alpha = 0, i.maskPath.length > 0) for (i.itemWineMask.graphics.beginFill(u).moveTo(i.maskPath[0].x, i.maskPath[0].y), n = 0; n < i.maskPath.length; n++) i.maskPath.length - n > 2 && t(n) && i.itemWineMask.graphics.curveTo(i.maskPath[n + 1].x, i.maskPath[n + 1].y, i.maskPath[n + 2].x, i.maskPath[n + 2].y); isNaN(i.wineStartX) && (i.wineStartX = i.canvasW / 2); var r = i.stageW; r = r < i.stageH ? i.stageH : r, i.itemWine = new createjs.Shape, i.itemWine.graphics.beginFill(i.wineColour).drawRect(0 - r, 0, r + r / 2, r), i.itemWine.x = i.canvasW / 2, i.itemWine.mask = i.itemWineMask, i.itemWine.y = i.wineStartY, i.itemWineTop = new createjs.Shape, i.itemWineTop.graphics.beginFill(i.wineColourTop).drawCircle(0, 0, i.wineWidth / 2), i.itemWineTop.mask = i.itemWineMask, i.itemWineTop.x = i.itemWine.x, i.itemWineTop.rotateCon = !0, i.itemWineTop.rotateNum = 0, "" != i.backgroundImage && i.itemCanvasContainer.addChild(i.itemBackground), i.itemCanvasContainer.addChild(i.itemWine, i.itemWineTop, i.itemWineMask), "" != i.image && i.itemCanvasContainer.addChild(i.itemBottle), i.stage.addChild(i.itemCanvasContainer), e.fn[o].resizeCanvas(a) }) }, e.fn[o].resizeCanvas = function (t) { return t.each(function () { var t = e(this), n = t.data("plugin_" + o); void 0 != n.itemCanvasContainer && (n.itemCanvasContainer.scaleX = n.itemCanvasContainer.scaleY = n.scalePercent) }) }, e.fn[o].resizeHolder = function (t, n, a) { return t.each(function () { var t = e(this), i = t.data("plugin_" + o); i.scalePercent = n / stageW, i.stageH * i.scalePercent > n && (i.scalePercent = a / i.stageH); var r = document.getElementById(t.attr("id")); r.width = i.stageW * i.scalePercent, r.height = i.stageH * i.scalePercent, e.fn[o].resizeCanvas(t) }) }, e.fn[o].animateWine = function (t, n) { return t.each(function () { var t = e(this), i = t.data("plugin_" + o); if (e(i.itemWine).clearQueue().stop(!0, !1), n) { if (i.wineLevelStatic != i.wineLevel) { var r = Math.abs(i.wineLevel - i.wineLevelStatic); i.wineLevelStatic = i.wineLevel; var s = i.wineLevel / 100 * i.wineHeight, c = i.wineStartY - s; e(i.itemWine).clearQueue().stop(!0, !1).animate({ y: c }, { duration: i.wineSpeed }), i.swirl && !i.swirlLoop && (e(i.itemWineTop).clearQueue().stop(!0, !1), r = r > 30 ? 30 : r, Math.random() < .5 ? i.itemWine.rotation = -r : i.itemWine.rotation = r, i.itemWineTop.rotation = i.itemWine.rotation, e(i.itemWineTop).clearQueue().stop(!0, !1).animate({ rotation: 0 }, 2 * i.wineSpeed, "easeOutElastic")) } } else { i.wineLevel = i.wineLevelStatic; var s = i.wineLevel / 100 * i.wineHeight, c = i.wineStartY - s; i.itemWineTop.y = c, i.itemWine.y = c, i.itemWineTop.scaleY = a(c, i.wineStartY, i.wineHeight) } }) }, e.fn[o].animateWineSwirl = function (t) { return t.each(function () { var t = e(this), n = t.data("plugin_" + o); if (n.swirlLoop) { var a = n.swirlRotateMax; n.itemWineTop.rotateCon ? n.itemWineTop.rotateCon = !1 : (n.itemWineTop.rotateCon = !0, a = -a), e(n.itemWineTop).clearQueue().stop(!0, !1).animate({ rotation: a }, { duration: n.swirlSpeed, easing: "easeInOutSine", complete: function () { e.fn[o].animateWineSwirl(t) } }) } else e(n.itemWineTop).clearQueue().stop(!0, !1).animate({ rotation: 0 }, { duration: n.swirlSpeed, easing: "easeOutBack" }) }) }, e.fn[o].tick = function () { for (n = 0; n < s.length; n++) { var e = s[n], t = e.data("plugin_" + o); void 0 != t.itemWine && (t.itemWine.rotation = t.itemWineTop.rotation, t.itemWineTop.y = t.itemWine.y, t.itemWineTop.scaleY = a(t.itemWine.y, t.wineStartY, t.wineHeight), t.stage.update()) } }, e.fn[o].buildEditCanvas = function (t) { return t.each(function () { var t = e(this), n = t.data("plugin_" + o); n.editContainer = new createjs.Container, n.editDot = new createjs.Shape, n.editDot.alpha = .5, n.editDot.graphics.beginFill(g).drawCircle(0, 0, d + 5), n.editDot.visible = !1, n.editShape = new createjs.Shape, n.itemCanvasContainer.addChild(n.editContainer) }) }, e.fn[o].resetEditStage = function (t) { return t.each(function () { var t = e(this), n = t.data("plugin_" + o); n.editContainer.removeAllChildren(), n.editContainer.addChild(n.editDot, n.editShape) }) }, e.fn[o].drawDots = function (t) { return t.each(function () { var t = e(this), a = t.data("plugin_" + o); for (n = 0; n < a.maskPath.length; n++) e.fn[o].drawDot(t, n, a.maskPath[n].x, a.maskPath[n].y) }) }, e.fn[o].drawDot = function (n, a, i, r) { return n.each(function () { var n = e(this), s = n.data("plugin_" + o), c = new createjs.Shape, g = 1 == t(a) ? u : l; g = 0 == a ? m : g, g = a == s.maskPath.length - 1 ? h : g, c.alpha = .5, c.graphics.beginFill(g).drawCircle(0, 0, d), c.x = i, c.y = r, s.editContainer.addChild(c), c.cursor = "pointer", c.name = a, c.addEventListener("mousedown", function (t) { e.fn[o].toggleDragEvent(n, t, "drag") }), c.addEventListener("pressmove", function (t) { e.fn[o].toggleDragEvent(n, t, "move") }), c.addEventListener("pressup", function (t) { e.fn[o].toggleDragEvent(n, t, "drop") }) }) }, e.fn[o].toggleDragEvent = function (t, n, a) { return t.each(function () { var t = e(this), i = t.data("plugin_" + o); switch (a) { case "drag": n.target.offset = { x: n.target.x - n.stageX / i.scalePercent, y: n.target.y - n.stageY / i.scalePercent }, n.target.alpha = .5, e.fn[o].toggleEditDot(t, n.target.x, n.target.y, n.target.name); break; case "move": n.target.alpha = .5, n.target.x = n.stageX / i.scalePercent + n.target.offset.x, n.target.y = n.stageY / i.scalePercent + n.target.offset.y, e.fn[o].toggleEditDot(t, n.target.x, n.target.y, n.target.name), i.maskPath[n.target.name].x = Math.round(n.target.x), i.maskPath[n.target.name].y = Math.round(n.target.y), e.fn[o].redrawEdit(t); break; case "drop": n.target.alpha = 1 } }) }, e.fn[o].toggleEditDot = function (t, n, a, i) { return t.each(function () { var t = e(this), r = t.data("plugin_" + o); r.editDot.x = n, r.editDot.y = a, r.editDot.visible = !0, r.editPointNum = i }) }, e.fn[o].addDot = function (t) { return t.each(function () { var t = e(this), n = t.data("plugin_" + o); 0 == n.maskPath.length ? n.maskPath = [{ x: 100, y: 100 }, { x: e("#newpointX").val(), y: e("#newpointY").val() }, { x: e("#newcurvepointX").val(), y: e("#newcurvepointY").val() }] : n.maskPath.push({ x: e("#newpointX").val(), y: e("#newpointY").val() }, { x: e("#newcurvepointX").val(), y: e("#newcurvepointY").val() }), e.fn[o].resetEditStage(t), e.fn[o].drawDots(t), e.fn[o].redrawEdit(t) }) }, e.fn[o].removeDot = function (n) { return n.each(function () { var n = e(this), a = n.data("plugin_" + o), i = a.editPointNum; t(a.editPointNum) && i--, a.maskPath.splice(i, 2), a.editDot.visible = !1, e.fn[o].resetEditStage(n), e.fn[o].drawDots(n), e.fn[o].redrawEdit(n) }) }, e.fn[o].removeEditDot = function (n) { return n.each(function () { var n = e(this), a = n.data("plugin_" + o), i = a.editPointNum; t(a.editPointNum) && i--, a.maskPath.splice(i, 2), e.fn[o].resetEditStage(n), e.fn[o].drawDots(n), e.fn[o].redrawEdit(n) }) }, e.fn[o].redrawEdit = function (a) { return a.each(function () { var a = e(this), i = a.data("plugin_" + o); if (i.editShape.graphics.clear(), i.maskPath.length > 0) for (i.editShape.graphics.beginStroke("red").beginFill(f).moveTo(i.maskPath[0].x, i.maskPath[0].y), i.editShape.alpha = .5, n = 0; n < i.maskPath.length; n++) i.maskPath.length - n > 2 && t(n) && i.editShape.graphics.curveTo(i.maskPath[n + 1].x, i.maskPath[n + 1].y, i.maskPath[n + 2].x, i.maskPath[n + 2].y); i.editShape.graphics.closePath() }) }, e.fn[o].outputDot = function (t) { return t.each(function () { var t = e(this), a = t.data("plugin_" + o), i = ""; for (n = 0; n < a.maskPath.length; n++) i += "{x:" + a.maskPath[n].x + ", y:" + a.maskPath[n].y + "}, "; alert("[" + i + "]") }) }, e.fn[o].commandWineAnimation = function (t, n, a, i) { return t.each(function () { var t = e(this), r = t.data("plugin_" + o); switch (n) { case "destroy": e.fn[o].destroy(t); break; case "addPoint": e.fn[o].addDot(t); break; case "removePoint": e.fn[o].removeDot(t); break; case "outputPoint": e.fn[o].outputDot(t); break; default: void 0 != r[a] && (r[a] = i, "wineLevel" == a ? e.fn[o].animateWine(t, !0) : "wineLevelStatic" == a ? e.fn[o].animateWine(t, !1) : e.fn[o].animateWineSwirl(t)) } }) }, e.fn[o].destroy = function (t) { return t.each(function () { var t = e(this), n = t.data("plugin_" + o); if (n.isLoaded) { n.isLoaded = !1, n.loader = null, n.stage.autoClear = !0, n.stage.removeAllChildren(), n.stage.update(); var a = s.indexOf(t); s.splice(a, 1), createjs.Ticker.removeEventListener("tick", n.stage), 0 == s.length && (c = !1, createjs.Ticker.removeEventListener("tick", e.fn[o].tick)) } }) } }(jQuery);